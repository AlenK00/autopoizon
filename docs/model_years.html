{% extends "base.html" %}

{% block title %}{{ model.name }} - Годы выпуска - AutoPoizon{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumbs">
        <a href="{{ url_for('index') }}">Главная</a> > 
        <a href="{{ url_for('brands') }}">Марки</a> > 
        <a href="#" id="back-to-models">{{ model.brand_id|capitalize }}</a> > 
        <span>{{ model.name }}</span>
    </div>
    
    <h1 class="page-title">Годы выпуска {{ model.name }}</h1>
    
    <div class="search-box" style="max-width: 600px; margin-bottom: 2rem;">
        <input type="text" id="year-search-input" placeholder="Поиск по году или VIN-номеру">
        <button id="year-search-button"><i class="fas fa-search"></i></button>
    </div>
    
    <div class="years-grid">
        {% for year in years|sort(reverse=true) %}
        <div class="year-card" data-year="{{ year }}">
            <div class="year-value">{{ year }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('year-search-input');
        const searchButton = document.getElementById('year-search-button');
        const yearCards = document.querySelectorAll('.year-card');
        const backLink = document.getElementById('back-to-models');
        
        searchButton.addEventListener('click', function() {
            const query = searchInput.value.trim();
            if (query) {
                window.location.href = "{{ url_for('search') }}?type=vin&q=" + encodeURIComponent(query);
            }
        });
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchButton.click();
            }
        });
        
        // Обработка клика по годам
        yearCards.forEach(card => {
            card.addEventListener('click', function() {
                const year = this.getAttribute('data-year');
                window.location.href = "{{ url_for('search') }}?type=vin&q=&model={{ model.id }}&year=" + year;
            });
        });
        
        // Обработка кнопки "Назад к моделям"
        if (backLink) {
            backLink.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = "/brand/{{ model.brand_id }}";
            });
        }
    });
</script>
{% endblock %}