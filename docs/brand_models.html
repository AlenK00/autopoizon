{% extends "base.html" %}

{% block title %}Модели {{ brand.name }} - AutoPoizon{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumbs">
        <a href="{{ url_for('index') }}">Главная</a> > 
        <a href="{{ url_for('brands') }}">Марки</a> > 
        <span>{{ brand.name }}</span>
    </div>
    
    <h1 class="page-title">Модели {{ brand.name }}</h1>
    
    <!-- Унифицированная поисковая строка -->
    <div class="unified-search">
        <div class="unified-search-box">
            <input type="text" class="unified-search-input" 
                   placeholder="Поиск по модели или VIN-номеру">
            <button class="unified-search-button">
                <i class="fas fa-search"></i>
                Найти
            </button>
        </div>
        
        <div class="unified-search-examples">
            Введите название модели или VIN-номер для поиска
        </div>
    </div>
    
    <div class="models-grid" id="models-container">
        {% for model in models %}
        <div class="model-card" data-model-id="{{ model.id }}">
            <div class="model-image">
                <img src="https://via.placeholder.com/250x150?text={{ model.name }}" alt="{{ model.name }}">
            </div>
            <div class="model-name">{{ model.name }}</div>
            <div class="model-years">Годы выпуска: {{ model.years|join(', ') }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.querySelector('.unified-search-input');
        const searchButton = document.querySelector('.unified-search-button');
        const modelCards = document.querySelectorAll('.model-card');
        
        // Быстрый поиск по моделям
        searchInput.addEventListener('input', function() {
            const query = this.value.toLowerCase().trim();
            
            modelCards.forEach(card => {
                const modelName = card.querySelector('.model-name').textContent.toLowerCase();
                const modelYears = card.querySelector('.model-years').textContent.toLowerCase();
                
                if (modelName.includes(query) || modelYears.includes(query)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        });
        
        // Поиск по VIN (переход на страницу поиска)
        searchButton.addEventListener('click', function() {
            const query = searchInput.value.trim();
            if (query) {
                // Проверяем, похоже ли на VIN (содержит буквы и цифры)
                if (query.match(/[a-zA-Z]/) && query.match(/[0-9]/)) {
                    window.location.href = "{{ url_for('search') }}?type=vin&q=" + encodeURIComponent(query);
                } else {
                    // Иначе ищем по названию модели
                    const filteredModels = Array.from(modelCards).filter(card => {
                        const modelName = card.querySelector('.model-name').textContent.toLowerCase();
                        return modelName.includes(query.toLowerCase());
                    });
                    
                    // Скрываем все модели и показываем только найденные
                    modelCards.forEach(card => card.style.display = 'none');
                    filteredModels.forEach(card => card.style.display = 'block');
                }
            }
        });
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchButton.click();
            }
        });
        
        // Обработка клика по моделям
        modelCards.forEach(card => {
            card.addEventListener('click', function() {
                const modelId = this.getAttribute('data-model-id');
                window.location.href = "/model/" + modelId;
            });
        });
    });
</script>
{% endblock %}