{% extends "base.html" %}

{% block title %}Каталог запчастей - AutoPoizon{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumbs">
        <a href="{{ url_for('index') }}">Главная</a>
        <span class="separator">></span>
        <span>Каталог запчастей</span>
    </div>
    
    <h1 class="page-title">Каталог запчастей</h1>
    
    <!-- Унифицированная поисковая строка -->
    <div class="unified-search">
        <div class="unified-search-tabs">
            <div class="unified-search-tab active" data-tab="part">Поиск по номеру детали</div>
            <div class="unified-search-tab" data-tab="name">Поиск по названию</div>
        </div>
        
        <div class="unified-search-box">
            <input type="text" class="unified-search-input" 
                   placeholder="Введите номер или название запчасти">
            <button class="unified-search-button">
                <i class="fas fa-search"></i>
                Найти
            </button>
        </div>
        
        <div class="unified-search-examples">
            Пример: CH-TG-001, Тормозные колодки, 36/0021239
        </div>
    </div>
    
    <!-- Улучшенные фильтры -->
    <div class="catalog-filters">
        <div class="filter-group">
            <label class="filter-label">
                <i class="fas fa-list"></i>
                Категория
            </label>
            <select class="filter-select" id="category-filter">
                <option value="all">Все категории</option>
                <option value="engine">Двигатель</option>
                <option value="transmission">Трансмиссия</option>
                <option value="brakes">Тормозная система</option>
                <option value="suspension">Подвеска</option>
                <option value="electrical">Электрика</option>
                <option value="body">Кузовные детали</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">
                <i class="fas fa-car"></i>
                Марка авто
            </label>
            <select class="filter-select" id="brand-filter">
                <option value="all">Все марки</option>
                <option value="chery">Chery</option>
                <option value="geely">Geely</option>
                <option value="haval">Haval</option>
                <option value="changan">Changan</option>
                <option value="byd">BYD</option>
                <option value="jac">JAC</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label class="filter-label">
                <i class="fas fa-cog"></i>
                Сортировка
            </label>
            <select class="filter-select" id="sort-filter">
                <option value="name">По названию</option>
                <option value="price-asc">Цена по возрастанию</option>
                <option value="price-desc">Цена по убыванию</option>
                <option value="popular">По популярности</option>
            </select>
        </div>
    </div>
    
    <div class="parts-grid" id="catalog-parts-container">
        {% for part in parts %}
        <div class="part-card">
            <div class="part-image">
                <img src="{{ url_for('static', filename='images/parts/' + part.image) }}" alt="{{ part.name }}" 
                     onerror="this.src='https://via.placeholder.com/300x200?text={{ part.name|urlencode }}'">
            </div>
            <div class="part-info">
                <div class="part-name">{{ part.name }}</div>
                <div class="part-number">Артикул: {{ part.part_number }}</div>
                <div class="part-compatibility">
                    Подходит для: 
                    {% if part.brand_id %}{{ part.brand_id|upper }}{% endif %}
                    {% if part.model_id %}{{ part.model_id }}{% endif %}
                </div>
                <div class="part-price">{{ part.price|int }} руб.</div>
                <div class="part-actions">
                    <button class="btn btn-primary add-to-cart" data-part-id="{{ part.id }}">
                        <i class="fas fa-shopping-cart"></i>
                        В корзину
                    </button>
                    <button class="btn btn-secondary">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="pagination">
        <button class="btn btn-secondary" id="prev-page">
            <i class="fas fa-arrow-left"></i>
            Назад
        </button>
        <span class="page-info">Страница 1 из 5</span>
        <button class="btn btn-secondary" id="next-page">
            Вперед
            <i class="fas fa-arrow-right"></i>
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchTabs = document.querySelectorAll('.unified-search-tab');
        const searchInput = document.querySelector('.unified-search-input');
        const searchButton = document.querySelector('.unified-search-button');
        
        // Обработка переключения вкладок поиска
        searchTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                searchTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                const searchType = this.getAttribute('data-tab');
                if (searchType === 'part') {
                    searchInput.placeholder = 'Введите номер или название запчасти';
                    document.querySelector('.unified-search-examples').textContent = 'Пример: CH-TG-001, Тормозные колодки, 36/0021239';
                } else {
                    searchInput.placeholder = 'Введите название запчасти';
                    document.querySelector('.unified-search-examples').textContent = 'Пример: Тормозные колодки, Масляный фильтр, Свечи зажигания';
                }
            });
        });
        
        // Обработка поиска
        searchButton.addEventListener('click', function() {
            const query = searchInput.value.trim();
            if (query) {
                // Здесь будет логика поиска в каталоге
                console.log('Поиск в каталоге:', query);
                alert('Поиск выполнен: ' + query);
            }
        });
        
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchButton.click();
            }
        });
        
        // Обработка фильтров
        const filters = document.querySelectorAll('.filter-select');
        filters.forEach(filter => {
            filter.addEventListener('change', function() {
                applyFilters();
            });
        });
        
        function applyFilters() {
            const category = document.getElementById('category-filter').value;
            const brand = document.getElementById('brand-filter').value;
            const sort = document.getElementById('sort-filter').value;
            
            console.log('Применены фильтры:', { category, brand, sort });
            // Здесь будет логика применения фильтров
        }
    });
</script>
{% endblock %}